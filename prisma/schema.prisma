// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  // output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String    @id @default(uuid()) @db.Uuid
  name      String
  username  String
  email     String
  password  String
  role      String
  isActive  Boolean   @default(true) @map("is_active")
  createdAt DateTime  @default(now())  @map("created_at")
  deletedAt DateTime? @map("deleted_at")

  media     Media[]
  bannersCreated Banner[] @relation("BannerCreator")
  bannersUpdated Banner[] @relation("BannerUpdater")

  createdArticles Article[]  @relation("ArticleCreator")
  updatedArticles Article[]  @relation("ArticleUpdater")

  createdEvents   Event[] @relation("EventCreator")
  updatedEvents   Event[] @relation("EventUpdater")

  createdCaseStudies CaseStudy[] @relation("CaseStudyCreator")
  updatedCaseStudies CaseStudy[] @relation("CaseStudyUpdater")

  @@unique([username, deletedAt])
  @@unique([email, deletedAt])

  @@index([role, isActive, deletedAt])
  @@index([isActive, deletedAt])
  @@index([createdAt(sort: Desc)])

  @@map("users")
}

model Media {
  id        String    @id @default(uuid()) @db.Uuid
  title     String?
  description   String?
  fileName  String    @map("file_name")
  filePath  String    @map("file_path")
  mimeType  String    @map("mime_type")
  fileSize  Int       @map("file_size")
  url       String?
  path      String?
  width     Int?
  height    Int?
  altText   String?   @map("alt_text")
  caption   String?

  createdBy String    @map("created_by") @db.Uuid
  creator   User      @relation(fields: [createdBy], references: [id])

  createdAt DateTime  @default(now()) @map("created_at")
  deletedAt DateTime? @map("deleted_at")

  images    Banner[]
  articles  Article[] @relation("ArticleThumbnail")

  eventThumbnails Event[] @relation("EventThumbnail")  

  caseStudyThumbnails CaseStudy[] @relation("CaseStudyThumbnail")  

  articlePublications    Article[]   @relation("ArticlePublication")
  caseStudyPublications  CaseStudy[] @relation("CaseStudyPublication")

  @@index([createdBy, deletedAt])
  @@index([mimeType, deletedAt])
  @@index([createdAt(sort: Desc)])
  @@index([deletedAt, mimeType, createdAt])
  @@map("media")
}

model Banner {
  id          String    @id @default(uuid()) @db.Uuid
  title       String
  description String
  imageId     String    @map("image_id") @db.Uuid
  image       Media     @relation(fields: [imageId], references: [id])

  linkImage   String?   @map("link_image")
  order       Int       @default(0)
  status      String    @default("draft")

  startDate   DateTime? @map("start_date")
  endDate     DateTime? @map("end_date")

  createdBy   String    @map("created_by") @db.Uuid
  creator     User      @relation("BannerCreator", fields: [createdBy], references: [id])

  updatedBy   String    @map("updated_by") @db.Uuid
  updater     User      @relation("BannerUpdater", fields: [updatedBy], references: [id])

  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @default(now()) @updatedAt @map("updated_at")
  deletedAt   DateTime? @map("deleted_at")

  @@index([status, startDate, endDate])
  @@index([deletedAt, status, order])
  @@index([status, deletedAt])
  @@index([order, deletedAt])
  @@index([startDate, endDate, status, deletedAt])
  @@map("banner")
}

model ArticleCategory {
  id          String    @id @default(uuid()) @db.Uuid
  name        String
  slug        String
  description String?
  isActive   Boolean    @default(true) @map("is_active")
  createdAt  DateTime   @default(now()) @map("created_at")
  deletedAt  DateTime?  @map("deleted_at")

  articles  Article[]

  @@unique([slug, deletedAt])
  @@index([isActive, deletedAt]) 
  @@map("article_categories")
}

model ArticleTag {
  id          String    @id @default(uuid())  @db.Uuid
  name        String
  slug        String
  isActive    Boolean   @default(true) @map("is_active")
  createdAt   DateTime  @default(now()) @map("create_at")
  deletedAt   DateTime? @map("deleted_at")

  articles   PivotArticleTag[]

  @@unique([slug, deletedAt])
  @@index([isActive, deletedAt])
  @@map("article_tags")
}

model Article {
  id      String @id @default(uuid()) @db.Uuid
  title   String
  slug    String
  excerpt String @db.Text
  content String @db.Text

  thumbnailId String? @map("thumbnail_id") @db.Uuid
  publicationId String? @map("publication_id") @db.Uuid

  metaTitle   String? @map("meta_title")
  metaDescription String? @map("meta_description")

  status  String
  publishedAt DateTime? @map("published_at")
  scheduledAt DateTime? @map("scheduled_at")

  viewCount   Int @default(0) @map("view_count")

  isFeatured  Boolean @default(false) @map("is_featured")
  createdBy   String  @map("created_by") @db.Uuid
  updatedBy   String?  @map("updated_by") @db.Uuid

  categoryId  String  @map("category_id") @db.Uuid

  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  deletedAt   DateTime?  @map("deleted_at")

  thumbnailMedia  Media?  @relation("ArticleThumbnail", fields: [thumbnailId], references: [id])
  publication     Media? @relation("ArticlePublication", fields: [publicationId], references: [id])

  category        ArticleCategory  @relation(fields: [categoryId], references: [id])
  creator         User      @relation("ArticleCreator", fields: [createdBy], references: [id])
  updater         User?     @relation("ArticleUpdater", fields: [updatedBy], references: [id])

  tags            PivotArticleTag[]
  seoKeywords     ArticleSeoKeyword[]

  @@unique([slug, deletedAt])
  @@index([status, deletedAt])
  @@index([isFeatured, deletedAt])
  @@index([categoryId, deletedAt, status])
  @@index([publishedAt(sort: Desc)])
  @@index([createdAt(sort: Desc)])
  @@index([viewCount(sort: Desc)])
  @@index([deletedAt, status, publishedAt])
  @@map("articles")
}

model PivotArticleTag {
  articleId String @map("article_id") @db.Uuid
  tagId     String @map("tag_id") @db.Uuid
  createdAt DateTime @default(now()) @map("created_at")

  articles Article @relation(fields: [articleId], references: [id], onDelete: Cascade)
  tag     ArticleTag     @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@id([articleId, tagId])
  @@index([tagId])
  @@map("pivot_article_tags")
}

model ArticleSeoKeyword {
  id  String  @id @default(uuid()) @db.Uuid
  articleId String @map("article_id") @db.Uuid
  keyword   String
  order     Int   @default(0)
  createdAt DateTime  @default(now()) @map("created_at")

  articles Article @relation(fields: [articleId], references: [id], onDelete: Cascade)

  @@unique([articleId, keyword])
  @@index([articleId])
  @@map("article_seo_keywords")
}

model Solution {
  id          String    @id @default(uuid()) @db.Uuid
  name        String
  slug        String
  description String?   @db.Text
  icon        String?
  color       String?
  order       Int       @default(0)
  isActive    Boolean   @default(true) @map("is_active")
  createdAt   DateTime  @default(now()) @map("created_at")
  deletedAt   DateTime? @map("deleted_at")

  caseStudies PivotCaseStudySolution[]
  // articles    ArticleSolution[]
  events      PivotEventSolution[]

  @@unique([slug, deletedAt])
  @@index([isActive, deletedAt])
  @@index([order, deletedAt])
  @@index([isActive, order, deletedAt])

  @@map("solutions")
}

model Industry {
  id          String    @id @default(uuid()) @db.Uuid
  name        String
  slug        String
  description String?   @db.Text
  icon        String?
  color       String?
  order       Int       @default(0)
  isActive    Boolean   @default(true) @map("is_active")
  createdAt   DateTime  @default(now()) @map("created_at")
  deletedAt   DateTime? @map("deleted_at")

  caseStudies PivotCaseStudyIndustry[]
  // articles    ArticleIndustry[]  

  @@unique([slug, deletedAt])
  @@index([isActive, deletedAt])
  @@index([order, deletedAt])
  @@index([isActive, order, deletedAt])

  @@map("industries")
}

model Capability {
  id          String    @id @default(uuid()) @db.Uuid
  name        String
  slug        String
  description String?   @db.Text
  icon        String?
  color       String?
  order       Int       @default(0)
  isActive    Boolean   @default(true) @map("is_active")
  createdAt   DateTime  @default(now()) @map("created_at")
  deletedAt   DateTime? @map("deleted_at")

  caseStudies PivotCaseStudyCapability[]

  @@unique([slug, deletedAt])
  @@index([isActive, deletedAt])
  @@index([order, deletedAt])
  @@index([isActive, order, deletedAt])

  @@map("capabilities")
}

model Event {
  id    String  @id @default(uuid()) @db.Uuid
  title String
  slug  String
  excerpt String? @db.Text
  content String? @db.Text

  thumbnailId   String? @map("thumbnail_id") @db.Uuid
  eventType String? @map("event_type")

  eventStart  DateTime  @map("event_start")
  eventEnd    DateTime  @map("event_end")

  location    String?
  locationType  String  @map("location_type")
  meetingUrl  String?

  registrationUrl String? @map("registration_url")
  quota   Int?

  status  String
  isFeatured  Boolean @default(false) @map("is_featured")

  createdBy String  @map("created_by") @db.Uuid
  updatedBy String?  @map("updated_by") @db.Uuid

  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt  @map("updated_at")
  deletedAt DateTime? @map("deleted_at")

  creator User  @relation("EventCreator", fields: [createdBy], references: [id])
  updater User? @relation("EventUpdater", fields: [updatedBy], references: [id])

  thumbnailMedia  Media?  @relation("EventThumbnail", fields: [thumbnailId], references: [id])
  
  solutions  PivotEventSolution[]

  @@unique([slug, deletedAt])

  @@index([status, deletedAt])
  @@index([isFeatured, deletedAt])
  @@index([eventStart, deletedAt])
  @@index([eventEnd, deletedAt])
  @@index([eventStart, eventEnd, status, deletedAt])
  @@index([locationType, deletedAt])
  @@index([status, eventStart, deletedAt])
  @@index([isFeatured, eventStart, deletedAt])
  @@index([eventType, deletedAt])
  @@index([createdAt(sort: Desc)])

  @@map("events")
}

model PivotEventSolution {
  eventId    String   @map("event_id") @db.Uuid
  solutionId String   @map("solution_id") @db.Uuid
  createdAt  DateTime @default(now()) @map("created_at")

  event    Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  solution Solution @relation(fields: [solutionId], references: [id], onDelete: Cascade)

  @@id([eventId, solutionId])
  @@index([solutionId])

  @@map("pivot_event_solutions")
}

model CaseStudy {
  id  String  @id @default(uuid()) @db.Uuid
  title String
  slug  String
  summary String?   @db.Text
  description String? @db.Text
  content String? @db.Text

  problem       String?   @db.Text
  solution      String?   @db.Text
  outcomes      Json?  

  client  String?
  projectUrl  String? @map("project_url")
  demoURL String? @map("demo_url")
  duration  String?
  year  Int?

  thumbnailId String? @map("thumbnail_id")  @db.Uuid
  publicationId String? @map("publication_id") @db.Uuid

  metaTitle       String?   @map("meta_title")
  metaDescription String?   @map("meta_description")  

  status  String  @default("draft")
  publishedAt DateTime? @map("published_at")
  isFeatured  Boolean @default(false) @map("is_featured")
  order Int @default(0)
  
  createdBy String  @map("created_by") @db.Uuid
  updatedBy String? @map("updated_by") @db.Uuid

  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt  @map("updated_at")
  deletedAt DateTime? @map("deleted_at")

  thumbnailMedia   Media?    @relation("CaseStudyThumbnail", fields: [thumbnailId], references: [id])
  publication    Media? @relation("CaseStudyPublication", fields: [publicationId], references: [id])
  
  creator User @relation("CaseStudyCreator", fields: [createdBy], references: [id])
  updater User? @relation("CaseStudyUpdater", fields: [updatedBy], references: [id])    
  solutions    PivotCaseStudySolution[]
  industries   PivotCaseStudyIndustry[] 
  capabilities PivotCaseStudyCapability[]
  seoKeywords  CaseStudySeoKeyword[]

  @@unique([slug, deletedAt])

  @@index([status, deletedAt])
  @@index([isFeatured, deletedAt])
  @@index([status, publishedAt, deletedAt])  
  @@index([year, deletedAt])
  @@index([isFeatured, status, deletedAt])
  @@index([order, deletedAt])
  @@index([status, order, deletedAt])  
  @@index([publishedAt(sort: Desc)])
  @@index([createdAt(sort: Desc)])

  @@map("case_studies")
}

model PivotCaseStudySolution {
  caseStudyId String   @map("case_study_id") @db.Uuid
  solutionId  String   @map("solution_id") @db.Uuid
  createdAt   DateTime @default(now()) @map("created_at")

  caseStudy CaseStudy @relation(fields: [caseStudyId], references: [id], onDelete: Cascade)
  solution  Solution  @relation(fields: [solutionId], references: [id], onDelete: Cascade)

  @@id([caseStudyId, solutionId])
  @@index([solutionId])

  @@map("pivot_case_study_solutions")
}

model PivotCaseStudyIndustry {
  caseStudyId String   @map("case_study_id") @db.Uuid
  industryId  String   @map("industry_id") @db.Uuid
  createdAt   DateTime @default(now()) @map("created_at")

  caseStudy CaseStudy @relation(fields: [caseStudyId], references: [id], onDelete: Cascade)
  industry  Industry  @relation(fields: [industryId], references: [id], onDelete: Cascade)

  @@id([caseStudyId, industryId])
  @@index([industryId])

  @@map("pivot_case_study_industries")
}

model PivotCaseStudyCapability {
  caseStudyId  String   @map("case_study_id") @db.Uuid
  capabilityId String   @map("capability_id") @db.Uuid
  createdAt    DateTime @default(now()) @map("created_at")

  caseStudy  CaseStudy  @relation(fields: [caseStudyId], references: [id], onDelete: Cascade)
  capability Capability @relation(fields: [capabilityId], references: [id], onDelete: Cascade)

  @@id([caseStudyId, capabilityId])
  @@index([capabilityId])

  @@map("pivot_case_study_capabilities")
}

model CaseStudySeoKeyword {
  id          String   @id @default(uuid()) @db.Uuid
  caseStudyId String   @map("case_study_id") @db.Uuid
  keyword     String
  order       Int      @default(0)
  createdAt   DateTime @default(now()) @map("created_at")

  caseStudy CaseStudy @relation(fields: [caseStudyId], references: [id], onDelete: Cascade)

  @@unique([caseStudyId, keyword])
  @@index([caseStudyId])
  @@map("case_study_seo_keywords")
}
