// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  // output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String    @id @default(uuid()) @db.Uuid
  name      String
  username  String
  email     String
  password  String
  role      String
  isActive  Boolean   @default(true) @map("is_active")
  createdAt DateTime  @default(now())  @map("created_at")
  deletedAt DateTime? @map("deleted_at")

  @@unique([username, deletedAt])
  @@unique([email, deletedAt])

  media     Media[]
  bannersCreated Banner[] @relation("BannerCreator")
  bannersUpdated Banner[] @relation("BannerUpdater")

  createdArticles Article[]  @relation("ArticleCreator")
  updatedArticles Article[]  @relation("ArticleUpdater")

  createdEvents   Event[] @relation("EventCreator")
  updatedEvents   Event[] @relation("EventUpdater")

  @@map("users")
}

model Media {
  id        String    @id @default(uuid()) @db.Uuid
  fileName  String    @map("file_name")
  filePath  String    @map("file_path")
  mimeType  String    @map("mime_type")
  fileSize  Int       @map("file_size")
  url       String?
  path      String?
  width     Int?
  height    Int?
  altText   String?   @map("alt_text")
  caption   String?

  createdBy String    @map("created_by") @db.Uuid
  creator   User      @relation(fields: [createdBy], references: [id])

  createdAt DateTime  @default(now()) @map("created_at")
  deletedAt DateTime? @map("deleted_at")

  images    Banner[]
  articles  Article[] @relation("ArticleThumbnail")

  eventThumbnails Event[] @relation("EventThumbnail")
  eventImages EventImage[]

  @@map("media")
}

model Banner {
  id          String    @id @default(uuid()) @db.Uuid
  title       String
  description String
  imageId     String    @map("image_id") @db.Uuid
  image       Media     @relation(fields: [imageId], references: [id])

  linkImage   String?   @map("link_image")
  order       Int       @default(0)
  status      String    @default("draft")

  startDate   DateTime? @map("start_date")
  endDate     DateTime? @map("end_date")

  createdBy   String    @map("created_by") @db.Uuid
  creator     User      @relation("BannerCreator", fields: [createdBy], references: [id])

  updatedBy   String    @map("updated_by") @db.Uuid
  updater     User      @relation("BannerUpdater", fields: [updatedBy], references: [id])

  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @default(now()) @updatedAt @map("updated_at")
  deletedAt   DateTime? @map("deleted_at")

  @@index([status, startDate, endDate])

  @@map("banner")
}

model Category {
  id          String    @id @default(uuid()) @db.Uuid
  name        String
  slug        String
  description String?
  isActive   Boolean    @default(true) @map("is_active")
  createdAt  DateTime   @default(now()) @map("created_at")
  deletedAt  DateTime?  @map("deleted_at")

  articles  Article[]

  @@unique([slug, deletedAt])
  @@map("categories")
}

model Tag {
  id          String    @id @default(uuid())  @db.Uuid
  name        String
  slug        String
  isActive    Boolean   @default(true) @map("is_active")
  createdAt   DateTime  @default(now()) @map("create_at")
  deletedAt   DateTime? @map("deleted_at")

  articles   ArticleTag[]

  @@unique([slug, deletedAt])
  @@map("tags")
}

model Article {
  id      String @id @default(uuid()) @db.Uuid
  title   String
  slug    String
  excerpt String @db.Text
  content String @db.Text

  thumbnailId String? @map("thumbnail_id") @db.Uuid

  metaTitle   String? @map("meta_title")
  metaDescription String? @map("meta_description")

  status  String
  publishedAt DateTime? @map("published_at")
  scheduledAt DateTime? @map("scheduled_at")

  viewCount   Int @default(0) @map("view_count")

  isFeatured  Boolean @default(false) @map("is_featured")
  createdBy   String  @map("created_by") @db.Uuid
  updatedBy   String?  @map("updated_by") @db.Uuid

  categoryId  String  @map("category_id") @db.Uuid

  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  deletedAt   DateTime?  @map("deleted_at")

  thumbnailMedia  Media?  @relation("ArticleThumbnail", fields: [thumbnailId], references: [id])
  category        Category  @relation(fields: [categoryId], references: [id])
  creator         User      @relation("ArticleCreator", fields: [createdBy], references: [id])
  updater         User?     @relation("ArticleUpdater", fields: [updatedBy], references: [id])

  tags            ArticleTag[]
  seoKeywords     ArticleSeoKeyword[]

  @@unique([slug, deletedAt])
  @@map("articles")
}

model ArticleTag {
  articleId String @map("article_id") @db.Uuid
  tagId     String @map("tag_id") @db.Uuid
  createdAt DateTime @default(now()) @map("created_at")

  article Article @relation(fields: [articleId], references: [id], onDelete: Cascade)
  tag     Tag     @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@id([articleId, tagId])
  @@map("article_tags")
}


model ArticleSeoKeyword {
  id  String  @id @default(uuid()) @db.Uuid
  articleId String @map("article_id") @db.Uuid
  keyword   String
  order     Int   @default(0)
  createdAt DateTime  @default(now()) @map("created_at")

  article Article @relation(fields: [articleId], references: [id], onDelete: Cascade)

  @@unique([articleId, keyword])
  @@index([articleId])
  @@map("article_seo_keywords")
}

model Event {
  id    String  @id @default(uuid()) @db.Uuid
  title String
  slug  String
  excerpt String?
  content String?

  thumbnailId   String? @map("thumbnail_id") @db.Uuid

  eventStart  DateTime  @map("event_start")
  eventEnd    DateTime  @map("event_end")

  location    String?
  locationType  String  @map("location_type")
  meetingUrl  String?

  registrationUrl String? @map("registration_url")
  quota   Int?

  status  String
  isFeatured  Boolean @default(false) @map("is_featured")

  createdBy String  @map("created_by") @db.Uuid
  updatedBy String?  @map("updated_by") @db.Uuid

  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt  @map("updated_at")
  deletedAt DateTime? @map("deleted_at")

  creator User  @relation("EventCreator", fields: [createdBy], references: [id])
  updater User? @relation("EventUpdater", fields: [updatedBy], references: [id])

  thumbnailMedia  Media?  @relation("EventThumbnail", fields: [thumbnailId], references: [id])

  images  EventImage[]

  @@unique([slug, deletedAt])
  @@map("events")
}

model EventImage {
  id  String  @id @default(uuid()) @db.Uuid
  eventId String  @map("event_id") @db.Uuid
  mediaId String  @map("media_id") @db.Uuid

  order     Int @default(0)

  createdAt DateTime  @default(now()) @map("created_at")

  event Event @relation(fields: [eventId], references: [id], onDelete: Cascade)
  media Media @relation(fields: [mediaId], references: [id])

  @@unique([eventId, mediaId])
  @@map("event_images")
}